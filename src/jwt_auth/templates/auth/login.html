<!DOCTYPE html>
<html>
<head>
    <title>Вход</title>
</head>
<body>
    <h2>Вход</h2>
    <form id="loginForm">
        {% csrf_token %}
        <div>
            <label>Логин:</label>
            <input type="text" name="login" required>
        </div>
        <div>
            <label>Пароль:</label>
            <input type="password" name="password" required>
        </div>
        <button type="submit">Войти</button>
    </form>

    <script>
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                login: e.target.login.value,
                password: e.target.password.value
            };

            try {
                const response = await fetch('/api/auth/login/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    localStorage.setItem('access_token', data.access);
                    localStorage.setItem('refresh_token', data.refresh);
                    alert('Вход выполнен!');
                    window.location.href = '/events/';
                } else {
                    alert('Ошибка: ' + (data.error || JSON.stringify(data)));
                }
            } catch (error) {
                console.error('Ошибка:', error);
                alert('Ошибка сети');
            }
        });
    </script>
</body>
</html>